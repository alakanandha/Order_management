{% extends "accounts/base.html" %}
{% block content %}
<!DOCTYPE html>
<html>
<head>
  <title>Manage Orders</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
  <h2 class="mb-4 text-center">Customer Orders</h2>

  <!-- Status Filter Buttons -->
  <div class="mb-3 text-center">
    <a href="{% url 'accounts:manage_orders' %}" class="btn btn-secondary btn-sm mx-1 {% if not current_status %}btn-primary{% endif %}">All</a>
    {% for choice, display in status_choices %}
      <a href="{% url 'accounts:manage_orders' %}?status={{ choice }}" 
         class="btn btn-sm mx-1 {% if current_status == choice %}btn-primary{% else %}btn-outline-primary{% endif %}">
        {{ display }}
      </a>
    {% endfor %}
  </div>

  {% if orders %}
  <table class="table table-bordered bg-white">
    <thead class="table-light">
      <tr>
        <th>ID</th>
        <th>Customer</th>
        <th>Product</th>
        <th>Quantity</th>
        <th>Total Price</th>
        <th>Payment</th>
        <th>Status</th>
        <th>Tracking ID</th>
        <th>Order Date</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for order in orders %}
      <tr>
        <td>{{ order.id }}</td>
        <td>{{ order.user.username }}</td>
        <td>{{ order.product.name }}</td>
        <td>{{ order.quantity }}</td>
        <td>â‚¹{{ order.total_price }}</td>
        <td>{{ order.payment_method }}</td>
        <td>{{ order.get_status_display }}</td>
        <td>{{ order.tracking_id }}</td>
        <td>{{ order.order_date|date:"d M Y, H:i" }}</td>
        <td>
          <!-- Update Form -->
          <form method="POST" class="d-flex flex-column mb-1">
            {% csrf_token %}
            <input type="hidden" name="order_id" value="{{ order.id }}">
            <select name="status" class="form-select mb-1">
              {% for choice, display in status_choices %}
                <option value="{{ choice }}" {% if order.status == choice %}selected{% endif %}>{{ display }}</option>
              {% endfor %}
            </select>
            <input type="text" name="tracking_id" class="form-control mb-1" placeholder="Tracking ID" value="{{ order.tracking_id }}">
            <button type="submit" class="btn btn-primary btn-sm w-100">Update</button>
          </form>

          <!-- View Button -->
          <a href="{% url 'accounts:view_order' order.id %}" class="btn btn-info btn-sm w-100 mt-1">View</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
    <p class="text-center">No orders found.</p>
  {% endif %}
</div>
</body>
</html>
{% endblock %}